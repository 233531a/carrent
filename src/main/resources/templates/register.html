<th:block th:with="title='–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è', active='register'"
          th:replace="~{_fragments/layout :: layout(${title}, ${active}, ~{::content})}">
    <th:block th:fragment="content">
        <div class="auth-shell-simple">
            <div class="auth-card-simple" data-reveal>
                <div class="auth-card__header">
                    <div style="font-size: 2.5rem; margin-bottom: 0.75rem; filter: drop-shadow(0 4px 12px rgba(59, 130, 246, 0.3));">üöó</div>
                    <h1 class="auth-title-simple">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
                    <p class="auth-subtitle-simple">–°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã –∞—Ä–µ–Ω–¥–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å</p>
                </div>

                <div class="alert alert--warn" th:if="${error}" th:text="${error}">–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</div>

                <div class="alert alert--success" th:if="${success}" th:text="${success}"></div>

                <form th:action="@{/register}" method="post" th:object="${form}" class="form-simple" id="registerForm">
                    <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}" />

                    <div class="field-simple">
                        <span>üë§ –õ–æ–≥–∏–Ω</span>
                        <input type="text" name="username" placeholder="–ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞" 
                               minlength="3" maxlength="100" required th:field="*{username}" />
                        <div class="hint-simple text-muted" th:if="${#fields.hasErrors('username')}" th:errors="*{username}"></div>
                    </div>

                    <div class="field-simple">
                        <span>üîí –ü–∞—Ä–æ–ª—å</span>
                        <div class="field-simple__pass">
                            <input type="password" id="password" name="password" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" 
                                   minlength="6" required th:field="*{password}" />
                            <button type="button" class="pass-toggle" onclick="togglePassword('password', this)" 
                                    aria-label="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å">üëÅ</button>
                        </div>
                        <div class="hint-simple text-muted" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
                        <div class="hint-simple text-muted">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤</div>
                    </div>

                    <div class="field-simple">
                        <span>üîí –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</span>
                        <div class="field-simple__pass">
                            <input type="password" id="confirmPassword" name="confirmPassword" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" 
                                   minlength="6" required th:field="*{confirmPassword}" />
                            <button type="button" class="pass-toggle" onclick="togglePassword('confirmPassword', this)" 
                                    aria-label="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å">üëÅ</button>
                        </div>
                        <div class="hint-simple text-muted" th:if="${#fields.hasErrors('confirmPassword')}" th:errors="*{confirmPassword}"></div>
                        <div class="hint-simple text-muted" id="passwordMatchHint"></div>
                    </div>

                    <button type="submit" class="btn-simple btn-simple--primary" style="width: 100%; margin-top: 0.25rem;">
                        –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                    </button>
                </form>

                <div class="auth-bottom-simple">
                    –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a th:href="@{/login}">–í–æ–π—Ç–∏</a>
                </div>

                <div class="auth-bottom-simple" style="margin-top: 1rem; font-size: 0.75rem; opacity: 0.7; border-top: none; padding-top: 0;">
                    üîí –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
                </div>
            </div>
        </div>

        <script>
            function togglePassword(inputId, button) {
                const input = document.getElementById(inputId);
                if (input.type === 'password') {
                    input.type = 'text';
                    button.textContent = 'üôà';
                } else {
                    input.type = 'password';
                    button.textContent = 'üëÅ';
                }
            }

            (function() {
                const password = document.getElementById('password');
                const confirmPassword = document.getElementById('confirmPassword');
                const hint = document.getElementById('passwordMatchHint');

                if (!password || !confirmPassword || !hint) return;

                function checkMatch() {
                    if (confirmPassword.value.length === 0) {
                        hint.textContent = '';
                        hint.className = 'hint-simple text-muted';
                        return;
                    }
                    if (password.value === confirmPassword.value) {
                        hint.textContent = '‚úì –ü–∞—Ä–æ–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                        hint.className = 'hint-simple';
                        hint.style.color = 'var(--success)';
                    } else {
                        hint.textContent = '‚úó –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                        hint.className = 'hint-simple';
                        hint.style.color = 'var(--danger)';
                    }
                }

                password.addEventListener('input', checkMatch);
                confirmPassword.addEventListener('input', checkMatch);
            })();

            (function() {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('is-visible');
                            observer.unobserve(entry.target);
                        }
                    });
                }, { threshold: 0.1 });

                document.querySelectorAll('[data-reveal]').forEach(el => observer.observe(el));
            })();
        </script>
    </th:block>
</th:block>
