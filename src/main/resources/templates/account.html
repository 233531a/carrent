<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Личный кабинет</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body th:replace="~{'_fragments/layout' :: layout('Личный кабинет', 'account', ~{::section})}">
<section class="container">

    <h1 class="page-title">Личный кабинет</h1>

    <div th:if="${param.cancelled}" class="alert alert--warn">
        Заявка отменена (ID: <span th:text="${param.cancelled}"></span>)
    </div>
    <div th:if="${param.completed}" class="alert">
        Аренда завершена (ID: <span th:text="${param.completed}"></span>)
    </div>

    <div th:if="${customer == null}" class="card">
        <p class="mb-0">Профиль клиента пока не оформлен.</p>
    </div>

    <div th:if="${customer != null}">
        <div class="table-wrap card">
            <table class="table table-striped table-hover align-middle">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Авто</th>
                    <th>Период</th>
                    <th>Статус</th>
                    <th style="width:200px;">Действия</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="r : ${rentals}">
                    <td th:text="${r.id}">1</td>
                    <td th:text="${r.car != null ? (r.car.make + ' ' + r.car.model) : '—'}">Марка Модель</td>
                    <td>
                        <span th:text="${#temporals.format(r.startDate, 'dd.MM.yyyy')}"></span> —
                        <span th:text="${#temporals.format(r.endDate, 'dd.MM.yyyy')}"></span>
                    </td>
                    <td>
            <span class="badge"
                  th:classappend="${
                     r.status.name()=='PENDING'   ? ' text-bg-warning'  :
                     r.status.name()=='ACTIVE'    ? ' text-bg-primary'  :
                     r.status.name()=='REJECTED'  ? ' text-bg-secondary':
                     r.status.name()=='COMPLETED' ? ' text-bg-success'  :
                                                    ' text-bg-light'}"
                  th:text="${r.status.titleRu}">Ожидание</span>
                    </td>
                    <td>
                        <form th:if="${r.status.name()=='PENDING'}"
                              th:action="@{|/account/rentals/${r.id}/cancel|}" method="post" style="display:inline;">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                            <button class="btn btn--danger btn--sm" type="submit"
                                    onclick="return confirm('Отменить заявку?');">Отменить</button>
                        </form>

                        <form th:if="${r.status.name()=='ACTIVE'}"
                              th:action="@{|/account/rentals/${r.id}/complete|}" method="post" style="display:inline;">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                            <button class="btn btn--sm" type="submit">Завершить</button>
                        </form>

                        <span th:if="${r.status.name()!='PENDING' and r.status.name()!='ACTIVE'}" class="text-muted">—</span>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(rentals)}">
                    <td colspan="5" class="text-center text-muted">У вас пока нет аренд</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

</section>
</body>
</html>
