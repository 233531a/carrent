<th:block th:with="title='–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç', active='account'"
          th:replace="~{_fragments/layout :: layout(${title}, ${active}, ~{::content})}">
    <th:block th:fragment="content">

        <div class="page-head">
            <h2 class="page-title" style="margin: 0;">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
            <a class="btn" th:href="@{/booking}">+ –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞</a>
        </div>

        <div th:if="${param.cancelled}" class="alert alert--warn" style="margin-bottom: var(--space-lg);">
            ‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞ (ID: <strong th:text="${param.cancelled}"></strong>)
        </div>
        <div th:if="${param.completed}" class="alert alert--success" style="margin-bottom: var(--space-lg);">
            ‚úÖ –ê—Ä–µ–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (ID: <strong th:text="${param.completed}"></strong>)
        </div>

        <div th:if="${customer == null}" class="card">
            <div style="text-align: center; padding: var(--space-xl);">
                <div style="font-size: 4rem; margin-bottom: var(--space-md);">üë§</div>
                <p style="font-size: var(--font-size-lg); margin-bottom: var(--space-sm);">–ü—Ä–æ—Ñ–∏–ª—å –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ–∫–∞ –Ω–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω</p>
                <p class="text-muted">–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω.</p>
            </div>
        </div>

        <div th:if="${customer != null}">
            <div class="card" style="margin-bottom: var(--space-xl);">
                <h3 style="margin-bottom: var(--space-md);">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="grid grid--3">
                    <div>
                        <div class="text-muted" style="font-size: var(--font-size-sm); margin-bottom: var(--space-xs);">–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</div>
                        <div style="font-size: var(--font-size-2xl); font-weight: 700; color: var(--primary);" 
                             th:text="${rentals != null ? #lists.size(rentals) : 0}">0</div>
                    </div>
                    <div>
                        <div class="text-muted" style="font-size: var(--font-size-sm); margin-bottom: var(--space-xs);">–ê–∫—Ç–∏–≤–Ω—ã–µ</div>
                        <div style="font-size: var(--font-size-2xl); font-weight: 700; color: var(--success);"
                             th:text="${rentals != null ? #lists.size(rentals.?[status.name() == 'ACTIVE']) : 0}">0</div>
                    </div>
                    <div>
                        <div class="text-muted" style="font-size: var(--font-size-sm); margin-bottom: var(--space-xs);">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ</div>
                        <div style="font-size: var(--font-size-2xl); font-weight: 700; color: var(--text-secondary);"
                             th:text="${rentals != null ? #lists.size(rentals.?[status.name() == 'COMPLETED']) : 0}">0</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: var(--space-lg);">üìã –ú–æ–∏ –∑–∞—è–≤–∫–∏</h3>
                <div class="table-wrap">
                    <table class="table table-striped table-hover">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ê–≤—Ç–æ–º–æ–±–∏–ª—å</th>
                            <th>–ü–µ—Ä–∏–æ–¥ –∞—Ä–µ–Ω–¥—ã</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th style="width:200px;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="r : ${rentals}" data-reveal>
                            <td><strong th:text="${r.id}">1</strong></td>
                            <td th:text="${r.car != null ? (r.car.make + ' ' + r.car.model) : '‚Äî'}">–ú–∞—Ä–∫–∞ –ú–æ–¥–µ–ª—å</td>
                            <td>
                                <div style="display: flex; flex-direction: column; gap: var(--space-xs);">
                                    <span th:text="${#temporals.format(r.startDate, 'dd.MM.yyyy')}"></span>
                                    <span style="color: var(--text-muted);">‚Üí</span>
                                    <span th:text="${#temporals.format(r.endDate, 'dd.MM.yyyy')}"></span>
                                </div>
                            </td>
                            <td>
                                <span class="badge"
                                      th:classappend="${
                                         r.status.name()=='PENDING'   ? ' text-bg-warning'  :
                                         r.status.name()=='ACTIVE'    ? ' text-bg-primary'  :
                                         r.status.name()=='REJECTED'  ? ' text-bg-secondary':
                                         r.status.name()=='COMPLETED' ? ' text-bg-success'  :
                                                                        ' text-bg-light'}"
                                      th:text="${r.status.titleRu}">–û–∂–∏–¥–∞–Ω–∏–µ</span>
                            </td>
                            <td>
                                <div style="display: flex; gap: var(--space-sm); flex-wrap: wrap;">
                                    <form th:if="${r.status.name()=='PENDING'}"
                                          th:action="@{|/account/rentals/${r.id}/cancel|}" 
                                          method="post" 
                                          style="display:inline;">
                                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                        <button class="btn btn--danger btn--sm" 
                                                type="submit"
                                                onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É?');">
                                            –û—Ç–º–µ–Ω–∏—Ç—å
                                        </button>
                                    </form>

                                    <form th:if="${r.status.name()=='ACTIVE'}"
                                          th:action="@{|/account/rentals/${r.id}/complete|}" 
                                          method="post" 
                                          style="display:inline;">
                                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                        <button class="btn btn--sm" type="submit">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
                                    </form>

                                    <span th:if="${r.status.name()!='PENDING' and r.status.name()!='ACTIVE'}" 
                                          class="text-muted" 
                                          style="font-size: var(--font-size-sm);">
                                        –ù–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π
                                    </span>
                                </div>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(rentals)}">
                            <td colspan="5" class="text-center" style="padding: var(--space-3xl);">
                                <div style="font-size: 4rem; margin-bottom: var(--space-md);">üöó</div>
                                <p style="font-size: var(--font-size-lg); margin-bottom: var(--space-sm);">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞—Ä–µ–Ω–¥</p>
                                <p class="text-muted">–ù–∞—á–Ω–∏—Ç–µ —Å <a th:href="@{/cars}">–≤—ã–±–æ—Ä–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è</a> –∏ —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–≤–æ–π –∑–∞—è–≤–∫–∏.</p>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <script>
            (function() {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('is-visible');
                        }
                    });
                }, { threshold: 0.1 });

                document.querySelectorAll('[data-reveal]').forEach(el => observer.observe(el));
            })();
        </script>
    </th:block>
</th:block>
